# 视频压缩

# 理论基础



## 压缩参数推荐:

### 按用途分

* 直播/实时通讯
* 录播/点播

### 录播里,也有用途区分

* 短视频上传
* 课程上传,长视频上传.比如bilibili,YouTube
* 电商评价之类的视频上传
* 个人本地存储/收藏

#### 普通上传视频:

统一压缩到720p

如果是码率模式,那么限定到:1500kps

如果是rcf模式,使用rcf=28

帧率=25

关键帧距= 5

## bilibli模式:



#### 视频关键帧间隔：2-5倍帧率即可

## 码率设置标准

### 几个平台的长视频录播/点播码率参考:

* [阿里云VOD](https://help.aliyun.com/document_detail/86068.html)

  | 清晰度 | 推荐码率 | 推荐分辨率 | 分辨率区间            |
  | :----- | :------- | :--------- | :-------------------- |
  | 流畅   | 400      | 640x360    | 128x128~640x360       |
  | 标清   | 900      | 960x540    | 641x361~960x540       |
  | 高清   | 1500     | 1280x720   | 961x541~1280x720      |
  | 超清   | 3000     | 1920x1080  | 1281x721~1920x1080    |
  | 2K     | 3500     | 2560x1440  | 1920x1080 ~2560x1440  |
  | 4K     | 6000     | 2560x1440  | 2560x1440 ~ 3840x2160 |

* [bilibili](https://www.bilibili.com/read/cv527957) 符合以下标准的视频,原视频不会被二压

  ![image-20210129101058517](https://gitee.com/hss012489/picbed/raw/master/picgo/1611886258559-image-20210129101058517.jpg)

  

  [2020升级后](https://www.bilibili.com/read/cv527957):  二压标准:

  在升级前，up主视频压制后720P清晰度码率最高1400k；

  1080P清晰度码率最高1800k；二压后不支持60帧率。
   升级后，up主视频压制后720P清晰度码率最高2000k；

  1080P清晰度码率最高3000k；1080P+清晰度码率最高6000k；

  新增720P60清晰度码率最高3000k，帧率60；

  新增1080P60 清晰度码率最高6000k ，帧率60。未达二压线，原清晰度输出策略不变



## 对录播的高质量视频 的 分辨率-码率做回归:

![image-20210129145713581](https://gitee.com/hss012489/picbed/raw/master/picgo/1611903433618-image-20210129145713581.jpg)

## 对用于上传的一般清晰度的 分辨率-码率做回归:

![image-20210129145837658](https://gitee.com/hss012489/picbed/raw/master/picgo/1611903517691-image-20210129145837658.jpg)



> 以上面两个一元公式为标准,在视频压缩前粗略估计该视频是否需要压缩.
>
> 后续也可采用PNSR方法来评估视频质量.







### 几个平台的通讯/直播参考码率:

[agora.io](https://docs.agora.io/cn/cloud-recording/recording_video_profile?platform=RESTful)

| 分辨率（宽 * 高） | 帧率 (fps) | 基准码率（Kbps，适用于通信） | 直播码率（Kbps，适用于直播） |
| :---------------- | :--------- | :--------------------------- | :--------------------------- |
| 640 * 480         | 30         | 750                          | 1500                         |
| 1280 * 720        | 15         | 1130                         | 2260                         |
| 1280 * 720        | 30         | 1710                         | 3420                         |
| 1920 * 1080       | 30         | 3150                         | 6300                         |

[融云实时音视频](https://support.rongcloud.cn/ks/MTA3OA==)

[腾讯云 实时音视频](https://cloud.tencent.com/document/product/647/32236)

[网易云信](https://dev.yunxin.163.com/docs/product/%E9%9F%B3%E8%A7%86%E9%A2%91%E9%80%9A%E8%AF%9D2.0/%E8%BF%9B%E9%98%B6%E5%8A%9F%E8%83%BD/%E8%A7%86%E9%A2%91%E7%AE%A1%E7%90%86/%E8%AE%BE%E7%BD%AE%E8%A7%86%E9%A2%91%E5%B1%9E%E6%80%A7)

[哔哩哔哩点播码率优化实践](https://cloud.tencent.com/developer/article/1660744)

